<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    <title>
      A-Level Economics Paper Marking Service | Expert Feedback | Economics
      Academy
    </title>
    <meta
      name="description"
      content="Submit your A-Level Economics practice papers for detailed, examiner-style feedback from an expert tutor. Improve your essay technique and boost your grades with our marking service."
    />
    <link rel="stylesheet" href="/css/main.css" />
    <style>
      .price {
        font-size: 1.75em;
        font-weight: bold;
        margin: 0.5em 0;
        color: #4caf50;
      }
      .save {
        font-size: 0.7em;
        color: #f56a6a;
      }
      .selected-service {
        border: 2px solid #4caf50;
        transform: scale(1.02);
        transition: all 0.3s ease;
      }
      .service-option {
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .service-option:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }
      .file-upload-area {
        border: 2px dashed #ccc;
        padding: 20px;
        text-align: center;
        margin-bottom: 20px;
        border-radius: 5px;
        background-color: #f9f9f9;
        cursor: pointer;
      }
      .file-upload-area:hover {
        border-color: #4caf50;
      }
      .file-preview {
        margin-top: 15px;
      }
      .file-preview-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f1f1f1;
        padding: 8px 12px;
        border-radius: 4px;
        margin-bottom: 8px;
      }
      .remove-file {
        color: #ff0000;
        cursor: pointer;
        font-weight: bold;
      }
      .form-error {
        color: #ff3860;
        font-size: 0.9em;
        margin-top: 5px;
      }
      .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.8);
        z-index: 9999;
        justify-content: center;
        align-items: center;
      }
      .spinner {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #4caf50;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @media (max-width: 768px) {
        .col-4 {
          width: 100%;
          margin-bottom: 20px;
        }
      }
      .payment-status {
        margin-top: 15px;
        padding: 10px;
        border-radius: 5px;
        display: none;
      }
      .payment-status.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .payment-status.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
    </style>
  </head>
  <body class="homepage is-preload">
    <div id="page-wrapper">
      <!-- Header -->
      <div id="header-placeholder"></div>

      <!-- Main -->
      <section id="main">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <!-- Marking Services -->
              <section>
                <header class="major">
                  <h2>Exam Paper Marking Services</h2>
                  <p>
                    Get detailed feedback on your practice papers to improve
                    your grades, straight from an Expert Economics Tutor
                  </p>
                </header>

                <div class="row">
                  <!-- Single Question Option -->
                  <div class="col-4 col-12-medium">
                    <section
                      class="box service-option"
                      data-product="single"
                      data-price="25"
                      data-payment-link="https://buy.stripe.com/test_cNi28tdt079l1Mm5AXdjO00"
                    >
                      <h3>Single 25-Mark Question</h3>
                      <div class="price">£25</div>
                      <ul class="alt">
                        <li>
                          Graded with comprehensive comments on Knowledge,
                          Application, Analysis and Evaluation
                        </li>
                        <li>Essay structure and technique feedback</li>
                        <li>Turnaround in 48 hours</li>
                      </ul>
                      <button class="button alt">Select</button>
                    </section>
                  </div>

                  <!-- Three Questions Option -->
                  <div class="col-4 col-12-medium">
                    <section
                      class="box service-option"
                      data-product="three"
                      data-price="60"
                      data-payment-link="https://buy.stripe.com/dRmcN760yalxez8gfBdjO01"
                    >
                      <h3>Three 25-Mark Questions</h3>
                      <div class="price">
                        £60 <span class="save">(Save £15)</span>
                      </div>
                      <ul class="alt">
                        <li>
                          Graded with comprehensive comments on Knowledge,
                          Application, Analysis and Evaluation
                        </li>
                        <li>Essay structure and technique feedback</li>
                        <li>Turnaround in 48 hours</li>
                      </ul>
                      <button class="button alt">Select</button>
                    </section>
                  </div>

                  <!-- Full Paper Option -->
                  <div class="col-4 col-12-medium">
                    <section
                      class="box service-option"
                      data-product="full"
                      data-price="60"
                      data-payment-link="https://buy.stripe.com/bJe4gBbkSctF2Qq3sPdjO02"
                    >
                      <h3>Full Exam Paper</h3>
                      <div class="price">£60</div>
                      <ul class="alt">
                        <li>Complete feedback on all questions</li>
                        <li>
                          Graded with comprehensive comments on Knowledge,
                          Application, Analysis and Evaluation
                        </li>
                        <li>Essay structure and technique feedback</li>
                        <li>Turnaround in 48 hours</li>
                      </ul>
                      <button class="button alt">Select</button>
                    </section>
                  </div>
                </div>

                <!-- Payment Form (hidden until selection) -->
                <div
                  id="payment-form"
                  class="box"
                  style="display: none; margin-top: 2em"
                >
                  <h3>
                    Complete Your Purchase:
                    <span id="selected-service-name"></span> (<span
                      id="selected-price"
                    ></span
                    >)
                  </h3>
                  <form
                    id="submission-form"
                    action="https://formspree.io/f/xnnbolzl"
                    method="POST"
                    enctype="multipart/form-data"
                  >
                    <input
                      type="hidden"
                      name="service_type"
                      id="service-type"
                      value=""
                    />
                    <input
                      type="hidden"
                      name="service_price"
                      id="service-price"
                      value=""
                    />

                    <div class="row gtr-uniform">
                      <div class="col-6 col-12-xsmall">
                        <label for="name">Full Name *</label>
                        <input
                          type="text"
                          name="name"
                          id="name"
                          value=""
                          placeholder="Your Name"
                          required
                        />
                        <div id="name-error" class="form-error"></div>
                      </div>
                      <div class="col-6 col-12-xsmall">
                        <label for="email">Email Address *</label>
                        <input
                          type="email"
                          name="email"
                          id="email"
                          value=""
                          placeholder="Email Address"
                          required
                        />
                        <div id="email-error" class="form-error"></div>
                      </div>
                      <div class="col-12">
                        <label for="description"
                          >Description of Work to be Marked *</label
                        >
                        <textarea
                          name="description"
                          id="description"
                          placeholder="Please describe what you want marked (e.g., 'Question 3 from 2022 Paper', 'Microeconomics essay on market failure')"
                          rows="3"
                          required
                        ></textarea>
                        <div id="description-error" class="form-error"></div>
                      </div>
                      <div class="col-12">
                        <label>Upload Your Work (PDF or Images) *</label>
                        <div class="file-upload-area" id="drop-zone">
                          <p>Drag & drop files here or click to browse</p>
                          <input
                            type="file"
                            id="file-input"
                            multiple
                            accept=".pdf,.jpg,.jpeg,.png"
                            style="display: none"
                          />
                          <button
                            type="button"
                            class="button small"
                            id="browse-btn"
                          >
                            Browse Files
                          </button>
                        </div>
                        <div id="file-error" class="form-error"></div>
                        <div class="file-preview" id="file-preview"></div>
                      </div>
                      <div class="col-12">
                        <button
                          type="button"
                          id="stripe-payment-btn"
                          class="button primary"
                        >
                          Complete Payment with Stripe
                        </button>
                        <div id="payment-status" class="payment-status"></div>
                      </div>
                    </div>
                  </form>
                </div>
              </section>

              <!-- FAQ Section -->
              <section style="margin-top: 3em">
                <header class="major">
                  <h2>Common Questions</h2>
                </header>
                <div class="row">
                  <div class="col-6 col-12-medium">
                    <section class="box">
                      <h3>Who marks my questions?</h3>
                      <p>
                        All questions are marked by Eliot King, an expert
                        Economics Tutor. For further information, visit our
                        About page.
                      </p>
                    </section>
                  </div>
                  <div class="col-6 col-12-medium">
                    <section class="box">
                      <h3>Other marking options?</h3>
                      <p>
                        If you have a marking request that is not included in
                        the options above, we can still help! Please share your
                        request via the Contact page and we will shortly be in
                        touch.
                      </p>
                    </section>
                  </div>
                </div>
                <div class="row">
                  <div class="col-6 col-12-medium">
                    <section class="box">
                      <h3>What do I receive?</h3>
                      <p>
                        You will receive a mark for all answers, and a grade if
                        submitting an entire paper. You will also receive in
                        depth feedback on every question, helping you identify
                        what you did well and comprehensive comments on how to
                        improve Knowledge, Application, Analysis and Evaluation.
                      </p>
                    </section>
                  </div>
                  <div class="col-6 col-12-medium">
                    <section class="box">
                      <h3>How do I submit my work?</h3>
                      <p>
                        You can email a scanned copy or Word/PDF file. I'll
                        return your work with annotated comments and a summary
                        of key areas for improvement. You may also send pictures
                        if you are unable to use Word/PDF.
                      </p>
                    </section>
                  </div>
                </div>
                <div style="text-align: center; margin-top: 2em">
                  <a href="/faq.html" class="button">View Full FAQ</a>
                </div>
              </section>
            </div>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <div id="footer-placeholder"></div>
    </div>

    <!-- Success Modal -->
    <div
      id="success-modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      "
    >
      <div
        style="
          background: white;
          padding: 2rem;
          border-radius: 12px;
          text-align: center;
          max-width: 500px;
          width: 90%;
        "
      >
        <h2 style="margin-bottom: 1rem; color: #2c3e50">Payment Successful!</h2>
        <p style="margin-bottom: 1.5rem">
          Thank you for your purchase. Your form has been submitted
          successfully. We will be in touch shortly regarding your paper
          marking.
        </p>
        <button id="close-modal" class="button">Close</button>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
      <div class="spinner"></div>
    </div>

    <!-- Scripts -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.dropotron.min.js"></script>
    <script src="/js/components/inject-templates.js"></script>
    <script src="/js/browser.min.js"></script>
    <script src="/js/breakpoints.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>

    <script>
      // Variables to store selected service and uploaded files
      let selectedService = null;
      let uploadedFiles = [];
      let paymentWindow = null;
      let paymentCheckInterval = null;
      const maxFileSize = 10 * 1024 * 1024; // 10MB max file size
      const maxTotalSize = 25 * 1024 * 1024; // 25MB max total size

      // DOM Elements
      const serviceOptions = document.querySelectorAll(".service-option");
      const paymentForm = document.getElementById("payment-form");
      const selectedServiceName = document.getElementById(
        "selected-service-name"
      );
      const selectedPrice = document.getElementById("selected-price");
      const serviceType = document.getElementById("service-type");
      const servicePrice = document.getElementById("service-price");
      const stripePaymentBtn = document.getElementById("stripe-payment-btn");
      const form = document.getElementById("submission-form");
      const dropZone = document.getElementById("drop-zone");
      const fileInput = document.getElementById("file-input");
      const browseBtn = document.getElementById("browse-btn");
      const filePreview = document.getElementById("file-preview");
      const successModal = document.getElementById("success-modal");
      const closeModalBtn = document.getElementById("close-modal");
      const loadingOverlay = document.getElementById("loading-overlay");
      const paymentStatus = document.getElementById("payment-status");

      // Service selection handling
      serviceOptions.forEach((option) => {
        option.addEventListener("click", function () {
          // Remove selected class from all services
          serviceOptions.forEach((opt) => {
            opt.classList.remove("selected-service");
          });

          // Add selected class to clicked service
          this.classList.add("selected-service");

          // Store selected service details
          selectedService = {
            type: this.dataset.product,
            price: this.dataset.price,
            paymentLink: this.dataset.paymentLink,
            name: this.querySelector("h3").textContent,
          };

          // Update payment form with selected service
          selectedServiceName.textContent = selectedService.name;
          selectedPrice.textContent = "£" + selectedService.price;
          serviceType.value = selectedService.type;
          servicePrice.value = selectedService.price;

          // Show payment form
          paymentForm.style.display = "block";

          // Scroll to payment form
          paymentForm.scrollIntoView({ behavior: "smooth" });
        });
      });

      // File upload handling
      browseBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        fileInput.click();
      });

      // Handle file selection
      fileInput.addEventListener("change", handleFiles);

      // Drag and drop functionality
      dropZone.addEventListener("dragover", function (e) {
        e.preventDefault();
        dropZone.style.borderColor = "#4caf50";
        dropZone.style.backgroundColor = "#f0f8f0";
      });

      dropZone.addEventListener("dragleave", function () {
        dropZone.style.borderColor = "#ccc";
        dropZone.style.backgroundColor = "#f9f9f9";
      });

      dropZone.addEventListener("drop", function (e) {
        e.preventDefault();
        dropZone.style.borderColor = "#ccc";
        dropZone.style.backgroundColor = "#f9f9f9";

        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          handleFiles({ target: fileInput });
        }
      });

      // Handle file processing
      function handleFiles(e) {
        const files = e.target.files;
        let totalSize = uploadedFiles.reduce(
          (total, file) => total + file.size,
          0
        );

        for (let i = 0; i < files.length; i++) {
          const file = files[i];

          // Validate file type
          if (!isValidFileType(file)) {
            showFileError("Please upload only PDF or image files (JPG, PNG).");
            continue;
          }

          // Validate file size
          if (file.size > maxFileSize) {
            showFileError(
              "File " + file.name + " is too large. Maximum size is 10MB."
            );
            continue;
          }

          // Validate total size
          if (totalSize + file.size > maxTotalSize) {
            showFileError("Total files size exceeds the 25MB limit.");
            break;
          }

          // Add to uploaded files
          uploadedFiles.push(file);
          totalSize += file.size;

          // Create preview
          const previewItem = document.createElement("div");
          previewItem.className = "file-preview-item";
          previewItem.innerHTML = `
            <span>${file.name} (${formatFileSize(file.size)})</span>
            <span class="remove-file" data-index="${
              uploadedFiles.length - 1
            }">×</span>
          `;
          filePreview.appendChild(previewItem);
        }

        // Clear file input
        fileInput.value = "";

        // Add event listeners to remove buttons
        document.querySelectorAll(".remove-file").forEach((btn) => {
          btn.addEventListener("click", function () {
            const index = parseInt(this.dataset.index);
            uploadedFiles.splice(index, 1);
            updateFilePreviews();
          });
        });

        // Clear any errors
        clearFileError();
      }

      // Update file previews
      function updateFilePreviews() {
        filePreview.innerHTML = "";

        uploadedFiles.forEach((file, index) => {
          const previewItem = document.createElement("div");
          previewItem.className = "file-preview-item";
          previewItem.innerHTML = `
            <span>${file.name} (${formatFileSize(file.size)})</span>
            <span class="remove-file" data-index="${index}">×</span>
          `;
          filePreview.appendChild(previewItem);
        });

        // Add event listeners to remove buttons
        document.querySelectorAll(".remove-file").forEach((btn) => {
          btn.addEventListener("click", function () {
            const index = parseInt(this.dataset.index);
            uploadedFiles.splice(index, 1);
            updateFilePreviews();
          });
        });
      }

      // Validate file type
      function isValidFileType(file) {
        const allowedTypes = [
          "application/pdf",
          "image/jpeg",
          "image/jpg",
          "image/png",
        ];
        return allowedTypes.includes(file.type);
      }

      // Format file size
      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      // Show file error
      function showFileError(message) {
        const errorElement = document.getElementById("file-error");
        errorElement.textContent = message;
        setTimeout(() => {
          errorElement.textContent = "";
        }, 5000);
      }

      // Clear file error
      function clearFileError() {
        document.getElementById("file-error").textContent = "";
      }

      // Form validation
      function validateForm() {
        let isValid = true;

        // Validate name
        const name = document.getElementById("name").value.trim();
        if (!name) {
          document.getElementById("name-error").textContent =
            "Please enter your name";
          isValid = false;
        } else {
          document.getElementById("name-error").textContent = "";
        }

        // Validate email
        const email = document.getElementById("email").value.trim();
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email) {
          document.getElementById("email-error").textContent =
            "Please enter your email address";
          isValid = false;
        } else if (!emailPattern.test(email)) {
          document.getElementById("email-error").textContent =
            "Please enter a valid email address";
          isValid = false;
        } else {
          document.getElementById("email-error").textContent = "";
        }

        // Validate description
        const description = document.getElementById("description").value.trim();
        if (!description) {
          document.getElementById("description-error").textContent =
            "Please describe what you want marked";
          isValid = false;
        } else {
          document.getElementById("description-error").textContent = "";
        }

        // Validate files
        if (uploadedFiles.length === 0) {
          document.getElementById("file-error").textContent =
            "Please upload at least one file";
          isValid = false;
        } else {
          document.getElementById("file-error").textContent = "";
        }

        return isValid;
      }

      // Handle Stripe payment button click
      stripePaymentBtn.addEventListener("click", function () {
        // Validate form
        if (!validateForm()) {
          return;
        }

        // Store form data in localStorage to retrieve after payment
        const formData = {
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          description: document.getElementById("description").value,
          service_type: document.getElementById("service-type").value,
          service_price: document.getElementById("service-price").value,
          files_count: uploadedFiles.length,
        };

        localStorage.setItem("pendingSubmission", JSON.stringify(formData));

        // Store files in a temporary FormData object
        const tempFormData = new FormData();
        uploadedFiles.forEach((file, index) => {
          tempFormData.append(`file_${index}`, file);
        });

        // Store file data temporarily (this is a simplified approach)
        // In a production environment, you might want to upload files to a temporary storage first
        localStorage.setItem("fileData", "pending");

        // Open Stripe payment in a new tab
        paymentWindow = window.open(selectedService.paymentLink, "_blank");

        // Show payment status message
        paymentStatus.textContent =
          "Payment window opened. Please complete your payment in the new tab. Do not close this page.";
        paymentStatus.className = "payment-status";
        paymentStatus.style.display = "block";

        // Start checking for payment completion
        startPaymentStatusCheck();
      });

      // Check payment status periodically
      function startPaymentStatusCheck() {
        // This is a simplified implementation
        // In a real scenario, you would use webhooks or check against a database

        paymentCheckInterval = setInterval(function () {
          // Check if the payment window is closed (user might have completed payment)
          if (paymentWindow && paymentWindow.closed) {
            clearInterval(paymentCheckInterval);

            // Ask user if they completed payment
            const didComplete = confirm("Did you complete the payment?");

            if (didComplete) {
              // Show loading overlay
              loadingOverlay.style.display = "flex";

              // Submit form to Formspree
              submitToFormspree();
            } else {
              paymentStatus.textContent =
                "Payment not completed. Please try again.";
              paymentStatus.className = "payment-status error";
            }
          }
        }, 2000);
      }

      // Submit form data to Formspree
      function submitToFormspree() {
        // Get stored form data
        const storedData = JSON.parse(
          localStorage.getItem("pendingSubmission") || "{}"
        );

        // Create FormData object
        const formData = new FormData();
        formData.append("name", storedData.name);
        formData.append("email", storedData.email);
        formData.append("description", storedData.description);
        formData.append("service_type", storedData.service_type);
        formData.append("service_price", storedData.service_price);

        // Add files
        uploadedFiles.forEach((file, index) => {
          formData.append("file_" + index, file);
        });

        // Submit to Formspree
        fetch(form.action, {
          method: "POST",
          body: formData,
          headers: {
            Accept: "application/json",
          },
        })
          .then((response) => {
            if (response.ok) {
              // Clear stored data
              localStorage.removeItem("pendingSubmission");
              localStorage.removeItem("fileData");

              // Hide loading overlay
              loadingOverlay.style.display = "none";

              // Show success message
              paymentStatus.textContent =
                "Payment and submission successful! We will be in touch shortly.";
              paymentStatus.className = "payment-status success";

              // Show success modal
              successModal.style.display = "flex";

              // Reset form
              form.reset();
              uploadedFiles = [];
              filePreview.innerHTML = "";
              paymentForm.style.display = "none";
              serviceOptions.forEach((opt) =>
                opt.classList.remove("selected-service")
              );
            } else {
              throw new Error("Form submission failed");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            loadingOverlay.style.display = "none";
            paymentStatus.textContent =
              "There was an error submitting your form. Please contact us directly.";
            paymentStatus.className = "payment-status error";
          });
      }

      // Close modal handler
      closeModalBtn.addEventListener("click", function () {
        successModal.style.display = "none";
      });

      // Check for pending submissions on page load
      window.addEventListener("load", function () {
        const pendingSubmission = localStorage.getItem("pendingSubmission");

        if (pendingSubmission) {
          const data = JSON.parse(pendingSubmission);

          // Ask user if they want to continue with pending submission
          const shouldContinue = confirm(
            "We noticed an incomplete submission. Would you like to continue?"
          );

          if (shouldContinue) {
            // Pre-fill form
            document.getElementById("name").value = data.name;
            document.getElementById("email").value = data.email;
            document.getElementById("description").value = data.description;
            document.getElementById("service-type").value = data.service_type;
            document.getElementById("service-price").value = data.service_price;

            // Show payment form
            paymentForm.style.display = "block";

            // Show message about files
            paymentStatus.textContent =
              "Please re-upload your files and complete the payment.";
            paymentStatus.className = "payment-status";
            paymentStatus.style.display = "block";
          } else {
            // Clear stored data
            localStorage.removeItem("pendingSubmission");
            localStorage.removeItem("fileData");
          }
        }
      });
    </script>
  </body>
</html>
